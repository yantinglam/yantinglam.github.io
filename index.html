<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Yanting Lam"><meta name="description" content="一个喜欢文艺的前端工程师"><title>Yanting Lam</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yantinglam.com/"><link rel="alternate" href="/atom.xml" title="Yanting Lam"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?8e7c7417ad2e322a37d13dc7cdc5454e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script><script type="text/javascript">AV.initialize("h9D4obRhn4aqzazLSG9Kxa2k-gzGzoHsz", "pRL4WjJEgaARQXXRWHLXbBgw")</script></head><body><div id="main"><header><a href="/." class="logo">Yanting Lam</a><ul class="nav"><li class="nav-link"><a href="/" class="active">首页</a></li><li class="nav-link"><a href="/archives/" target="_self">归档</a></li><li class="nav-link"><a href="/tags/" target="_self">标签</a></li><li class="nav-link"><a href="/photography/" target="_self">摄影集</a></li></ul></header><section id="container"><ul class="home"><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/28/SpringCloud-2016-12-28-Spring-Cloud-Feign/" class="post-link">Spring Cloud - Feign</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-28</span><span id="/2016/12/28/SpringCloud-2016-12-28-Spring-Cloud-Feign/" data-flag-title="Spring Cloud - Feign" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是Feign？"><a href="#什么是Feign？" class="headerlink" title="什么是Feign？"></a>什么是Feign？</h3><p>&emsp;&emsp;Feign是一个声明式的Web Service客户端，它旨在通过最少的资源和代码来实现和HTTP API的连接，使得编写Web Service客户端变得更加简单。它的使用方法是定义一个接口，然后在上面添加注解（支持JAX-RS标准的注解)。Feign支持可插拔式的编码器和解码器。<br></div><a href="/2016/12/28/SpringCloud-2016-12-28-Spring-Cloud-Feign/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/23/SpringCloud-2016-12-23-Spring-Cloud-Hystrix/" class="post-link">Spring-Cloud - 断路器</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-23</span><span id="/2016/12/23/SpringCloud-2016-12-23-Spring-Cloud-Hystrix/" data-flag-title="Spring-Cloud - 断路器" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><p>&emsp;&emsp;在微服务架构中，是将一个个业务功能拆分成一个个小的服务，各个服务之间通过IPC机制进行通信，因此有可能因为网络故障或依赖服务自身问题出现延迟或调用故障。若此时调用方不断增加请求，最后就会出现因等待依赖服务响应而造成任务积压，最终导致自身服务的瘫痪。为了解决这个问题，Spring Cloud给出了断路器模式。<br></div><a href="/2016/12/23/SpringCloud-2016-12-23-Spring-Cloud-Hystrix/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/21/Seven-years-is-a-life-2016-12-21-Compound-interest/" class="post-link">人生最重要的概念：复利</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-21</span><span id="/2016/12/21/Seven-years-is-a-life-2016-12-21-Compound-interest/" data-flag-title="人生最重要的概念：复利" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><p>&emsp;&emsp;首先来看个例子：A找B借一只鸡，但B只有一只鸡，而且家里的娃天天等着鸡下蛋吃。B想到自己还有10个贝壳，在市场上可以换到一只鸡，于是B好心地将10个贝壳借给了A。A拿着10个贝壳到市场上换了一只鸡，鸡生蛋，蛋生鸡。过了一段时间，想起当初借B的10个贝壳，于是抱着一只刚出生的鸡到市场上换了10个贝壳拿去还给B。B说：“嗯？你应该至少还我20个贝壳吧？”这时个A愤怒了：“你怎么可以这么无耻！你明明借给我10个贝壳，那些贝壳不借给我，放在那里也是放着，难道它们会自动变成二十个？我的那些鸡是我辛辛苦苦养出来的，你什么都没干，就多要10个贝壳？你太坏了！”。<br></div><a href="/2016/12/21/Seven-years-is-a-life-2016-12-21-Compound-interest/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/20/SpringCloud-2016-12-20-Spring-Cloud-service-discovery/" class="post-link">Spring Cloud - 服务注册与消费</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-20</span><span id="/2016/12/20/SpringCloud-2016-12-20-Spring-Cloud-service-discovery/" data-flag-title="Spring Cloud - 服务注册与消费" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是Spring-Cloud？"><a href="#什么是Spring-Cloud？" class="headerlink" title="什么是Spring Cloud？"></a>什么是Spring Cloud？</h3><p>&emsp;&emsp;Spring Cloud是一个基于Spring Boot实现的云应用开发工具，它为基于JVM的云应用开发中的配置管理、服务发现、断路器、智能路由、微代理、控制总线、全局锁、决策竞选、分布式会话和集群状态管理等操作提供了一种简单的开发方式。<br></div><a href="/2016/12/20/SpringCloud-2016-12-20-Spring-Cloud-service-discovery/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/16/Microservices-2016-12-16-Single-mode-app-to-micro-service/" class="post-link">从单体式架构迁移到微服务架构</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-16</span><span id="/2016/12/16/Microservices-2016-12-16-Single-mode-app-to-micro-service/" data-flag-title="从单体式架构迁移到微服务架构" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><p>&emsp;&emsp;从单体式架构迁移到微服务架构不应该通过从头重写代码的方式实现，而是应该通过逐步迁移的方式。<br></div><a href="/2016/12/16/Microservices-2016-12-16-Single-mode-app-to-micro-service/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/16/Microservices-2016-12-16-Deployment-strategy-of-micro-service/" class="post-link">微服务部署策略</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-16</span><span id="/2016/12/16/Microservices-2016-12-16-Deployment-strategy-of-micro-service/" data-flag-title="微服务部署策略" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="单机多服务实例模式（传统的应用部署方法）"><a href="#单机多服务实例模式（传统的应用部署方法）" class="headerlink" title="单机多服务实例模式（传统的应用部署方法）"></a>单机多服务实例模式（传统的应用部署方法）</h3><p>&emsp;&emsp;这种模式需要提供若干台物理或虚拟机，每台机器上运行多个服务实例，每个服务实例运行一个或者多个主机的well-known端口。</p>
<p>&emsp;&emsp;这种模式有两个参数：</p>
<ul>
<li>一个参数代表每个服务实例由多少个进程构成</li>
<li>一个参数定义同一进程组内有多少服务实例运行</div><a href="/2016/12/16/Microservices-2016-12-16-Deployment-strategy-of-micro-service/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/16/Microservices-2016-12-16-Data-management-of-micro-service/" class="post-link">微服务的数据管理问题</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-16</span><span id="/2016/12/16/Microservices-2016-12-16-Data-management-of-micro-service/" data-flag-title="微服务的数据管理问题" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="数据管理情况"><a href="#数据管理情况" class="headerlink" title="数据管理情况"></a>数据管理情况</h3><p>&emsp;&emsp;在微服务架构中，数据是服务私有的，外部要想访问某个服务的数据，唯一的访问方式是通过API。如果多个服务访问同一个数据，schema会更新访问时间，并在所有服务之间进行协调。也会有不同的微服务使用不同的数据库的情况，在这种情况下，应用会产生各种不同的数据，因此基于微服务的应用一般都使用SQL和NoSQL结合的数据库。<br></div><a href="/2016/12/16/Microservices-2016-12-16-Data-management-of-micro-service/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/15/Photography-2016-12-15-Problem-of-photo-disposure/" class="post-link">照片曝光问题</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-15</span><span id="/2016/12/15/Photography-2016-12-15-Problem-of-photo-disposure/" data-flag-title="照片曝光问题" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是曝光？"><a href="#什么是曝光？" class="headerlink" title="什么是曝光？"></a>什么是曝光？</h3><p>&emsp;&emsp;曝光就是让感光材料接受光线的照射，影响的是整体画面的亮暗程度。</p>
<p>&emsp;&emsp;影响曝光的三个因素：光圈、快门、感光度。<br></div><a href="/2016/12/15/Photography-2016-12-15-Problem-of-photo-disposure/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/15/Photography-2016-12-15-Fundamentals-of-photography/" class="post-link">摄影基础知识</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-15</span><span id="/2016/12/15/Photography-2016-12-15-Fundamentals-of-photography/" data-flag-title="摄影基础知识" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="画幅"><a href="#画幅" class="headerlink" title="画幅"></a>画幅</h3><p>&emsp;&emsp;画幅就是感觉材料的大小</p>
<h4 id="全画幅与非全画幅"><a href="#全画幅与非全画幅" class="headerlink" title="全画幅与非全画幅"></a>全画幅与非全画幅</h4><p>&emsp;&emsp;全画幅就是以前胶卷的大小，为36*24mm。除了这个大小的，其他画幅都是非全画幅。现在有很多种画幅尺寸，如下图。<br></div><a href="/2016/12/15/Photography-2016-12-15-Fundamentals-of-photography/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/15/Photography-2016-12-15-Classification-of-cameras/" class="post-link">相机的分类</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-15</span><span id="/2016/12/15/Photography-2016-12-15-Classification-of-cameras/" data-flag-title="相机的分类" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="摄影与摄影器材"><a href="#摄影与摄影器材" class="headerlink" title="摄影与摄影器材"></a>摄影与摄影器材</h3><p>&emsp;&emsp;摄影最本质的是一种画面语言的表达，而摄影器材只是辅助摄影的一种工具。所以拍出一张好的照片的关键不在于手上的摄影器材有多贵多高级，在于摄影师对摄影的感悟，对所拍事物的感知与表达能力。</p>
<blockquote>
<p>伟大摄影师的伟大地方，不是他的技术，更不是他所用的器材，而是他的品格和内涵<br></div><a href="/2016/12/15/Photography-2016-12-15-Classification-of-cameras/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/15/Microservices-2016-12-15-Service-discovery/" class="post-link">服务发现机制</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-15</span><span id="/2016/12/15/Microservices-2016-12-15-Service-discovery/" data-flag-title="服务发现机制" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是服务发现机制？"><a href="#什么是服务发现机制？" class="headerlink" title="什么是服务发现机制？"></a>什么是服务发现机制？</h3><p>&emsp;&emsp;服务发现机制说白了就是用来找到微服务架构中各个服务实例的一个机制。<br></div><a href="/2016/12/15/Microservices-2016-12-15-Service-discovery/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/15/Microservices-2016-12-15-IPC-of-micro-service/" class="post-link">微服务架构的IPC</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-15</span><span id="/2016/12/15/Microservices-2016-12-15-IPC-of-micro-service/" data-flag-title="微服务架构的IPC" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><p>&emsp;&emsp;IPC即进程间通信（Inter-Porcess Communication）。微服务架构中有两类IPC机制可选：异步消息机制和同步请求/响应机制。</div><a href="/2016/12/15/Microservices-2016-12-15-IPC-of-micro-service/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/15/Microservices-2016-12-15-API-Gateway-of-micro-service/" class="post-link">微服务架构中的API Gateway</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-15</span><span id="/2016/12/15/Microservices-2016-12-15-API-Gateway-of-micro-service/" data-flag-title="微服务架构中的API Gateway" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是API-Gateway"><a href="#什么是API-Gateway" class="headerlink" title="什么是API Gateway?"></a>什么是API Gateway?</h3><p>&emsp;&emsp;API Gateway是客户端与微服务系统之间的中间件，是客户端访问微服务系统的唯一入口。</div><a href="/2016/12/15/Microservices-2016-12-15-API-Gateway-of-micro-service/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/14/Microservices-2016-12-14-Fundamentals-of-micro-service/" class="post-link">微服务架构的认识</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-14</span><span id="/2016/12/14/Microservices-2016-12-14-Fundamentals-of-micro-service/" data-flag-title="微服务架构的认识" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是微服务？"><a href="#什么是微服务？" class="headerlink" title="什么是微服务？"></a>什么是微服务？</h3><p>&emsp;&emsp;微服务是一种架构风格，在这种架构中，由一个或多个微服务组成一个大型应用或软件。一个微服务代表着一个小的业务功能，各个微服务之间是松耦合的，通过<a href="#IPC-explanation" name="IPC">IPC</a>相互通信。单个微服务可以被独立部署。<br></div><a href="/2016/12/14/Microservices-2016-12-14-Fundamentals-of-micro-service/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/13/Distrubited-2016-12-13-Distributed-cluster/" class="post-link">分布式集群</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-13</span><span id="/2016/12/13/Distrubited-2016-12-13-Distributed-cluster/" data-flag-title="分布式集群" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是分布式集群？"><a href="#什么是分布式集群？" class="headerlink" title="什么是分布式集群？"></a>什么是分布式集群？</h3><p>&emsp;&emsp;首先看看分布式与集群之间的区别与联系：</p>
<ul>
<li>分布式是指将不同的业务分布在不同的地方；而集群是指将同一个业务部署到多台机器上</li>
<li>分布式的组织比较松散；而集群有一定的组织</li>
<li>分布式每一个节点完成不同的业务，一旦一个节点宕掉了，在这个节点上的业务就不可访问了；而集群里一旦某一台服务器宕掉了，其他的服务器可以顶上来</li>
<li>分布式的每一个节点都可以做成一个集群</div><a href="/2016/12/13/Distrubited-2016-12-13-Distributed-cluster/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/13/Distrubited-2016-12-13-Cluster/" class="post-link">集群</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-13</span><span id="/2016/12/13/Distrubited-2016-12-13-Cluster/" data-flag-title="集群" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是集群？"><a href="#什么是集群？" class="headerlink" title="什么是集群？"></a>什么是集群？</h3><p>&emsp;&emsp;集群是指在多台不同的服务器中部署相同的应用或服务模块，构成一个集群，通过负载均衡设备对外提供服务。</p>
<h3 id="为什么要用集群？"><a href="#为什么要用集群？" class="headerlink" title="为什么要用集群？"></a>为什么要用集群？</h3><p>&emsp;&emsp;通过集群可以在低成本的情况下获得在性能、可靠性、灵活性方面的相对较高的收益。<br></div><a href="/2016/12/13/Distrubited-2016-12-13-Cluster/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/12/13/Distrubited-2016-12-13-Distributed/" class="post-link">分布式</a></h2><p class="post-meta"><span class="post-time">发表于 2016-12-13</span><span id="/2016/12/13/Distrubited-2016-12-13-Distributed/" data-flag-title="分布式" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><h3 id="什么是分布式？"><a href="#什么是分布式？" class="headerlink" title="什么是分布式？"></a>什么是分布式？</h3><p>&emsp;&emsp;分布式是指在多台不同的服务器中部署不同的服务模块，通过远程调用协同工作，对外提供服务。</p>
<h3 id="为什么要用分布式？"><a href="#为什么要用分布式？" class="headerlink" title="为什么要用分布式？"></a>为什么要用分布式？</h3><p>&emsp;&emsp;要理解为什么要使用分布式，首先来了解一下<strong>集中式系统</strong>。</p>
<p>&emsp;&emsp;集中式系统简单来说就是将一个应用和服务都部署在一台服务器上，整个应用和服务的业务功能都在这台服务器上完成。这种结构在应用和服务的部署上面非常简单，只需要将应用的运行实例安装到一台服务器上就可以了。<br></div><a href="/2016/12/13/Distrubited-2016-12-13-Distributed/" class="read-more">阅读全文..</a></article></li><li class="post-item"><article class="post"><h2 class="post-title"><a href="/2016/11/23/hexo-2016-11-23-Fail-to-install-hexo-renderer-sass/" class="post-link">安装hexo-renderer-sass失败</a></h2><p class="post-meta"><span class="post-time">发表于 2016-11-23</span><span id="/2016/11/23/hexo-2016-11-23-Fail-to-install-hexo-renderer-sass/" data-flag-title="安装hexo-renderer-sass失败" class="leancloud-visitors"><span class="leancloud-visitors-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></p><div class="post-content"><p>在使用hexo做github博客的时候，找到一些很简洁的主题想要使用，其中有些主题需要安装hexo-render-sass来渲染页面布局，此时遇到了错误：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">build error! Stack Error: ‘c:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe failed with <span class="built_in">exit</span> code:1......</div></pre></td></tr></table></figure></p></div><a href="/2016/11/23/hexo-2016-11-23-Fail-to-install-hexo-renderer-sass/" class="read-more">阅读全文..</a></article></li></ul><div class="paginator"></div></section><footer><div class="social"><a href="mailto:linyantingly@163.com" title="email" class="iconfont icon-email"></a><a href="https://github.com/yantinglam" title="github" class="iconfont icon-github"></a><a href="/atom.xml" title="rss" class="iconfont icon-rss"></a></div><div class="friendly-links"><h6 class="friendly-links-text">友情链接</h6><a href="http://davidleee.com/" class="friendly-links-url">David Lee(IOS工程师)</a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2017<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Yanting Lam</span></p><p class="calculate"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script><script type="text/javascript">function showPostTime(Counter) {
    var query = new AV.Query(Counter);
    var entries = [];
    var $visitors = $(".leancloud-visitors");

    $visitors.each(function () {
      entries.push( $(this).attr("id").trim() );
    });

    query.containedIn('url', entries);
    query.find()
      .done(function (results) {
        var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

        $visitors.find(COUNT_CONTAINER_REF).text(0);

        for (var i = 0; i < results.length; i++) {
          var item = results[i];
          var url = item.get('url');
          var time = item.get('time');
          var element = document.getElementById(url);

          $(element).find(COUNT_CONTAINER_REF).text(time);
        }
      })
      .fail(function (object, error) {
        console.log("Error: " + error.code + " " + error.message);
      });
  }

  function addPostCount(Counter) {
    var $visitors = $(".leancloud-visitors");
    var url = $visitors.attr('id').trim();
    var title = $visitors.attr('data-flag-title').trim();
    var query = new AV.Query(Counter);

    query.equalTo("url", url);
    query.find({
      success: function(results) {
        if (results.length > 0) {
          var counter = results[0];
          counter.fetchWhenSave(true);
          counter.increment("time");
          counter.save(null, {
            success: function(counter) {
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.get('time'));
            },
            error: function(counter, error) {
              console.log('Failed to save Visitor num, with error message: ' + error.message);
            }
          });
        } else {
          var newcounter = new Counter();
          newcounter.set("title", title);
          newcounter.set("url", url);
          newcounter.set("time", 1);
          newcounter.save(null, {
            success: function(newcounter) {
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
            },
            error: function(newcounter, error) {
              console.log('Failed to create');
            }
          });
        }
      },
      error: function(error) {
        console.log('Error:' + error.code + " " + error.message);
      }
    });
  }

  $(function() {
    var Counter = AV.Object.extend("Counter");
    if ($('.leancloud-visitors').length == 1) {
      addPostCount(Counter);
    } else if ($('.post-link').length > 1) {
      showPostTime(Counter);
    }
  });
</script><script type="text/javascript">function showLikeTime() {
  //- var LikeCounter = AV.Object.extend("LikeCounter");
  var query = new AV.Query("LikeCounter");
  var entries = [];
  var $like = $(".photo-meta");

  $like.each(function () {
    entries.push( $(this).attr("id").trim() );
  });

  query.find()
    .done(function (results) {
      console.log(results);
      var COUNT_CONTAINER_REF = '.like-num';

      $like.find(COUNT_CONTAINER_REF).text(0);

      for (var i = 0; i < results.length; i++) {
        var item = results[i];
        var name = item.get('name');
        var time = item.get('time');
        var element = document.getElementById(name);

        $(element).find(COUNT_CONTAINER_REF).text(time);
      }
    })
    .fail(function (object, error) {
      console.log("Error: " + error.code + " " + error.message);
    });
}

function addLikeCount(name) {
  var LikeCounter = AV.Object.extend("LikeCounter");
  var query = new AV.Query(LikeCounter);

  query.equalTo("name", name);
  query.find({
    success: function(results) {
      console.log(results);
      if (results.length > 0) {
        var counter = results[0];
        counter.fetchWhenSave(true);
        counter.increment("time");
        counter.save(null, {
          success: function(counter) {
            var $element = $(document.getElementById(name));
            $element.find('.like-num').text(counter.get('time'));
          },
          error: function(counter, error) {
            console.log('Failed to save Visitor num, with error message: ' + error.message);
          }
        });
      } else {
        var newcounter = new LikeCounter();
        newcounter.set("name", name);
        newcounter.set("time", 1);
        newcounter.save(null, {
          success: function(newcounter) {
            var $element = $(document.getElementById(name));
            $element.find('.like-num').text(newcounter.get('time'));
          },
          error: function(newcounter, error) {
            console.log('Failed to create');
          }
        });
      }
    },
    error: function(error) {
      console.log('Error:' + error.code + " " + error.message);
    }
  });
}

function deleteLikeCount(name) {
  var LikeCounter = AV.Object.extend("LikeCounter");
  var query = new AV.Query(LikeCounter);

  query.equalTo("name", name);
  query.find({
    success: function(results) {
      console.log(results);
      if (results.length > 0) {
        var counter = results[0];
        counter.fetchWhenSave(true);
        counter.increment("time", -1);
        counter.save(null, {
          success: function(counter) {
            var $element = $(document.getElementById(name));
            $element.find('.like-num').text(counter.get('time'));
          },
          error: function(counter, error) {
            console.log('Failed to save Visitor num, with error message: ' + error.message);
          }
        });
      }
    },
    error: function(error) {
      console.log('Error:' + error.code + " " + error.message);
    }
  });
}


$(".photo-like").click(function() {
    if($(this).hasClass("dislike")) {
        $(this).attr("src", "/images/Photos/like.png").removeClass("dislike").addClass("like");
        addLikeCount($(this).parent().attr("id"));
    } else {
        $(this).attr("src", "/images/Photos/dislike.png").removeClass("like").addClass("dislike");
        deleteLikeCount($(this).parent().attr("id"));
    }
});

$(function() {
  showLikeTime();
})</script></body></html>